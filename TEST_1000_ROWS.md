# 1000行性能测试

## 测试文件

**位置:**
- 左侧: `test-data/left-1000.xlsx` (1000行)
- 右侧: `test-data/right-1000.xlsx` (1020行)

**数据结构:**
- ID, Name, Age, City, Department, Salary, Status, Email
- 8列数据
- 真实的员工信息模拟

## 差异分布

**预计总差异: ~330处**

| 类型 | 频率 | 数量 | 说明 |
|------|------|------|------|
| 名字修改 | 每10行 | ~100 | Name 字段添加 "Jr." |
| 年龄/工资修改 | 每15行 | ~67 | Age +1, Salary +5000 |
| 城市/部门修改 | 每20行 | ~50 | City 和 Department 变化 |
| 状态修改 | 每25行 | ~40 | Status 变化 |
| 多字段修改 | 每30行 | ~33 | 多个字段同时修改 |
| 删除 | 每50行 | ~20 | 整行删除 |
| 新增 | 末尾 | 20 | 新增20行 |

## 启动方式

### 方法1: 使用启动脚本（推荐）
```bash
start-1000-rows.bat
```

### 方法2: 命令行
```bash
npm start -- --excel "test-data/left-1000.xlsx" --excel "test-data/right-1000.xlsx"
```

## 性能测试要点

### 1. 渲染性能
- [ ] 初始加载时间 < 2秒
- [ ] 虚拟化模式下滚动流畅（60 FPS）
- [ ] 标准模式下滚动是否卡顿
- [ ] 切换虚拟化/标准模式响应快速

### 2. Diff 计算
- [ ] Diff 计算时间 < 3秒
- [ ] 显示加载进度
- [ ] UI 不冻结
- [ ] 异步计算正常工作

### 3. 导航功能
- [ ] Pre/Next Diff 按钮响应快速
- [ ] Diff 下拉框加载快速
- [ ] 跳转到指定行流畅
- [ ] 滚动同步正常

### 4. 上下文折叠
- [ ] 开启上下文模式响应快速
- [ ] 调整上下文行数立即生效
- [ ] 展开/折叠功能正常
- [ ] 显示隐藏行数统计准确

### 5. 内存占用
- [ ] 虚拟化模式内存 < 200MB
- [ ] 标准模式内存 < 500MB
- [ ] 长时间使用无内存泄漏
- [ ] 切换 Sheet 内存释放正常

### 6. 编辑功能
- [ ] 单元格编辑响应正常
- [ ] 编辑后 Diff 重算快速
- [ ] 大量编辑不卡顿

## 预期性能指标

### 虚拟化模式（推荐）
- **初始加载**: < 2秒
- **Diff 计算**: < 3秒
- **滚动 FPS**: 60
- **内存占用**: < 200MB
- **导航响应**: < 100ms

### 标准模式
- **初始加载**: < 5秒
- **Diff 计算**: < 3秒
- **滚动 FPS**: 30-40
- **内存占用**: < 500MB
- **导航响应**: < 200ms

## 对比小文件（10行）

| 指标 | 10行 | 1000行 | 倍数 |
|------|------|--------|------|
| 数据量 | 10 | 1000 | 100x |
| 差异数 | 8 | ~330 | 41x |
| 加载时间 | < 0.5s | < 2s | 4x |
| 内存占用 | ~50MB | ~200MB | 4x |

**结论**: 虚拟化渲染使性能增长远小于数据量增长！

## 压力测试场景

### 场景1: 快速滚动
1. 开启虚拟化模式
2. 快速滚动到底部
3. 快速滚动到顶部
4. 观察是否卡顿

### 场景2: 频繁导航
1. 连续点击 Next Diff 50次
2. 连续点击 Pre Diff 50次
3. 观察响应速度

### 场景3: 上下文切换
1. 开启上下文模式
2. 调整上下文行数 0-20
3. 频繁切换显示全部/上下文
4. 观察性能

### 场景4: 模式切换
1. 虚拟化 → 标准
2. 标准 → 虚拟化
3. 重复10次
4. 观察内存和性能

### 场景5: 长时间使用
1. 打开应用
2. 各种操作30分钟
3. 观察内存是否持续增长
4. 检查是否有内存泄漏

## 已知限制

1. **标准模式**: 1000行会有轻微卡顿，建议使用虚拟化模式
2. **编辑性能**: 大量编辑会触发完整 Diff 重算，可能较慢
3. **内存占用**: 标准模式内存占用较高

## 优化建议

如果性能不达标：

1. **确保使用虚拟化模式**
2. **开启上下文折叠**（减少渲染行数）
3. **关闭不必要的功能**
4. **检查系统资源**（CPU/内存）

## 成功标准

✅ **通过测试的标准:**
- 虚拟化模式下滚动流畅
- Diff 导航响应快速
- 内存占用合理
- 无明显卡顿
- 所有功能正常工作

---

**创建时间**: 2026-02-05
**测试版本**: 0.2.2 + Excel Style UI
